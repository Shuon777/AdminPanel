<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Baikal Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<aside class="sidebar">
    <div class="sidebar-header">
        <a href="/" class="sidebar-logo">üåø –≠–∫–æ–ë–∞–π–∫–∞–ª</a>
    </div>
    <nav class="sidebar-nav">
        <a href="/" class="nav-item {% if active_page == 'dashboard' %}active{% endif %}">
            <i class="bi bi-house"></i> –û–±–∑–æ—Ä
        </a>
        <a href="/logs" class="nav-item {% if active_page == 'logs' %}active{% endif %}">
            <i class="bi bi-shield-exclamation"></i> –ñ—É—Ä–Ω–∞–ª –æ—à–∏–±–æ–∫
        </a>
        <a href="/chat" class="nav-item {% if active_page == 'chat' %}active{% endif %}">
            <i class="bi bi-chat-dots"></i> –¢–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç
        </a>
        <div style="padding: 24px 16px 8px; font-size: 11px; font-weight: 800; color: #9ca3af; text-transform: uppercase;">–î–∞–Ω–Ω—ã–µ</div>
        <a href="#" class="nav-item"><i class="bi bi-tree"></i> –§–ª–æ—Ä–∞</a>
        <a href="#" class="nav-item"><i class="bi bi-bug"></i> –§–∞—É–Ω–∞</a>
    </nav>
</aside>

<main class="main-content">
    <header>
        <h1>{% block title %}{% endblock %}</h1>
        
        <div class="bot-status">
            <span id="status-dot" class="dot {% if bot_online %}online{% else %}offline{% endif %}"></span>
            <span id="status-text" style="font-weight: bold;">–ë–æ—Ç {{ '–æ–Ω–ª–∞–π–Ω' if bot_online else '–æ—Ñ—Ñ–ª–∞–π–Ω' }}</span>
        </div>
    </header>

    {% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
async function refreshBotStatus() {
    try {
        const response = await fetch('/bot-status');
        const data = await response.json();
        const isOnline = data.online === true || data.online === "true";

        // 1. –û–ë–ù–û–í–õ–ï–ù–ò–ï –í –®–ê–ü–ö–ï (–≤–µ–∑–¥–µ)
        const dot = document.getElementById('status-dot');
        const text = document.getElementById('status-text');
        if (dot) dot.className = isOnline ? 'dot online' : 'dot offline';
        if (text) {
            text.textContent = isOnline ? '–ë–æ—Ç –æ–Ω–ª–∞–π–Ω' : '–ë–æ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω';
            text.style.color = isOnline ? '' : '#ef4444';
        }

        // 2. –û–ë–ù–û–í–õ–ï–ù–ò–ï –ù–ê –î–ê–®–ë–û–†–î–ï (—Ç–æ–ª—å–∫–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π)
        const dashText = document.getElementById('dash-status-text');
        const dashDesc = document.getElementById('dash-status-desc');
        
        if (dashText) {
            dashText.textContent = isOnline ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ –≤ —Å–µ—Ç–∏';
            dashText.style.color = isOnline ? '#10b981' : '#ef4444';
        }
        if (dashDesc) {
            dashDesc.textContent = isOnline 
                ? '–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–∏–≥–Ω–∞–ª –ø–æ–ª—É—á–µ–Ω –º–µ–Ω–µ–µ 15 –º–∏–Ω. –Ω–∞–∑–∞–¥' 
                : '–ë–æ—Ç –¥–∞–≤–Ω–æ –Ω–µ –≤—ã—Ö–æ–¥–∏–ª –Ω–∞ —Å–≤—è–∑—å';
        }

    } catch (e) {
        console.error("–û—à–∏–±–∫–∞ Heartbeat:", e);
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑ –≤ 15 —Å–µ–∫—É–Ω–¥
setInterval(refreshBotStatus, 15000);
// –ò —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
refreshBotStatus();
</script>
</body>
</html>